// Generated by CoffeeScript 1.6.1
(function(e){return e.fn.ajaxChosen=function(t,n,r){var i,s,o,u;t==null&&(t={});r==null&&(r={});s={minTermLength:3,afterTypeDelay:500,jsonTermKey:"term",keepTypingMsg:"Keep typing...",lookingForMsg:"Looking for"};u=this;i=null;o=e.extend({},s,e(u).data(),t);this.chosen(r?r:{});return this.each(function(){return e(this).next(".chzn-container").find(".search-field > input, .chzn-search > input").bind("keyup",function(){var r,s,a,f,l;f=e(this).val();l=e.trim(e(this).val());s=l.length<o.minTermLength?o.keepTypingMsg:o.lookingForMsg+(" '"+l+"'");u.next(".chzn-container").find(".no-results").text(s);if(l===e(this).data("prevVal"))return!1;e(this).data("prevVal",l);this.timer&&clearTimeout(this.timer);if(l.length<o.minTermLength)return!1;r=e(this);o.data==null&&(o.data={});o.data[o.jsonTermKey]=l;o.dataCallback!=null&&(o.data=o.dataCallback(o.data));a=o.success;o.success=function(i){var s,o,a;if(i==null)return;a=[];u.find("option").each(function(){return e(this).is(":selected")?a.push(e(this).val()):e(this).remove()});u.find("optgroup:empty").each(function(){return e(this).remove()});s=n!=null?n(i,r):i;o=0;e.each(s,function(t,n){var r,i,s;o++;if(n.group){r=u.find("optgroup[label='"+n.text+"']");r.size()||(r=e("<optgroup />"));r.attr("label",n.text).appendTo(u);return e.each(n.items,function(t,n){var i,s;if(typeof n=="string"){s=t;i=n}else{s=n.value;i=n.text}if(e.inArray(s,a)===-1)return e("<option />").attr("value",s).html(i).appendTo(r)})}if(typeof n=="string"){s=t;i=n}else{s=n.value;i=n.text}if(e.inArray(s,a)===-1)return e("<option />").attr("value",s).html(i).appendTo(u)});if(o)u.trigger("liszt:updated");else{u.data().chosen.no_results_clear();u.data().chosen.no_results(r.val())}t.success!=null&&t.success(i);return r.val(f)};return this.timer=setTimeout(function(){i&&i.abort();return i=e.ajax(o)},o.afterTypeDelay)})})}})(jQuery);