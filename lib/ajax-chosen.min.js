(function(b){return b.fn.ajaxChosen=function(c,h,f){var e,a,g;null==c&&(c={});null==h&&(h={});null==f&&(f=function(){});g=this;e=null;a=b.extend({},{minTermLength:3,afterTypeDelay:500,jsonTermKey:"term"},c);this.chosen(f?f:{});return this.each(function(){return b(this).next(".chzn-container").find(".search-field > input, .chzn-search > input").bind("keyup",function(){var f,c,i,d;d=b.trim(b(this).attr("value"));c=d.length<a.minTermLength?"Keep typing...":"Looking for '"+d+"'";g.next(".chzn-container").find(".no-results").text(c);
if(d===b(this).data("prevVal"))return!1;b(this).data("prevVal",d);this.timer&&clearTimeout(this.timer);if(d.length<a.minTermLength)return!1;f=b(this);null==a.data&&(a.data={});a.data[a.jsonTermKey]=d;null!=a.dataCallback&&(a.data=a.dataCallback(a.data));i=a.success;a.success=function(a){var c,e;if(a!=null){e=[];g.find("optgroup").each(function(){return b(this).remove()});g.find("option").each(function(){return b(this).is(":selected")?e.push(b(this).val()+"-"+b(this).text()):b(this).remove()});c=h(a);
b.each(c,function(a,c){var d;if(c.group){d=b("<optgroup />").attr("label",c.text).appendTo(g);return b.each(c.items,function(a,c){if(b.inArray(a+"-"+c,e)===-1)return b("<option />").attr("value",a).html(c).appendTo(d)})}if(b.inArray(a+"-"+c,e)===-1)return b("<option />").attr("value",a).html(c).appendTo(g)});g.trigger("liszt:updated");i!=null&&i(a);return f.attr("value",d)}};return this.timer=setTimeout(function(){e&&e.abort();return e=b.ajax(a)},a.afterTypeDelay)})})}})(jQuery);